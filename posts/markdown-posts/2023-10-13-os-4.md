---
date: 2023-10-13
title: 作業系統筆記 (4)
subtitle: Processes Concept
category: personal-note
frontCover: https://www.ionos.com/digitalguide/fileadmin/DigitalGuide/Teaser/operating-system-t.jpg
tag: personal-note, courses, os
---
### Process Concept
- An operating system concurrently executes a variety of programs (e.g. Web broswer, text editor, etc)
  - Program
    - passive entity
    - **binary stored in disk**
  - Process
    - active entity
    - **a program in execution in memory**
- A process includes  
  - Code segment (text section)
    - 程式碼
    - 不是一般的 code，是 compile 好的 instructions
  - Data section
    - global variables
  - Stack
    - temporary local variables and functions
  - Heap
    - dynamic allocated variables or classes
    - malloc()
  - Current activity (**program counter**, register contents)
    - 目前執行到 code 的哪一行
    - context switch 後，要把 registers 裡面的狀態存起來
  - A set of associated **resources** (e.g. open file handlers)
    - resources hardware control

#### Process in memory
```img
process-in-memory.png
```

#### Thread
- A.k.a **lightweight process**
- 可以共用 memory 空間
- basic unit of CPU utilization
  - process 切成一個或多個 thread
- All threads **belonging to the same process** share
  - **code** section, **data** section and **OS resources** (e.g. open files and signals)
- But each thread has its own
  - **thread ID**, **program counter**, **register set** and a **stack**
- 因為有自己的 local variable，彼此可以用 global variable 溝通
```img
Thread.png
```

#### Process State
- States
  - **New**: the process is being created
    - program load 到 memory
    - 如果 memory 不夠，就會失敗
  - **Ready**: the process is in the memory waiting to be assigned to a processor
    - program in queue，準備競爭 CPU 資源
  - **Running**: instructions are being executed by CPU
  - **Waiting**: the process is waiting for events to occur
    - 暫時不需要使用 CPU 的時候，像是 IO
  - **Terminated**: the process has finished execution

#### Diagram of Process State
- Only one process is **running** on any processor at any instant
- However, many processes may be **ready** or **waiting**
```img
process-state-diagram.png
```
- admitted
  - memory 不夠或是沒有 permission，就無法執行
- interrupt
  - 通常是 timer 被 fire 出來，像是 time-sharing-system 超過某 minisecond，就會 running process switch 給 OS scheduler
- I/O or event wait
  - 做了 I/O 或 sleep，process 會進入 waiting queue
- I/O or event completion
  - I/O 或 sleep 結束，process 會進入 ready queue，才有機會再次被執行

#### Process Control Block (PCB)
- Information associated with each process
- **存在 kernel 自己的 memory 裡面**
- 使用者建立 process，OS 幫使用者建立時自己會建立 PCB 做管理
#### Structure
- Pointer
  - 指到在 queue 裡面的下一個 PCB
- Process state
  - 記錄狀態，像是現在是在 waiting queue 還是 ready queue 
- Program counter
  - 是 OS 幫 process 記的，使用者或是 process 的 memory space 裡面是沒有的
- CPU registers
- CPU scheduling information
  - e.g. priority
- Memory-management information
  - e.g. base/limit register
    - 只有在這個城市執行的時候才會 load 到 hardware，因為 hardware 的 register 只有兩三個
- I/O status information
  - 記錄現在是在做哪個 I/O device 的 I/O，因為不同 I/O device 有不同的 waiting queue
- Accounting information
  - 開了多少個 file

#### Context switch
- Kernel saves the state of the old process and loads the saved state for the new process
- Contexe-switch time is purely **overhead**
- Switch time (about 1 ~ 1000 ms) depends on
  - memory speed, number of registers
  - existence of special intructions
    - a single instruction to save/load all registers
  - hardware support
    - **multiple sets of registers** 
    - CPU 原本只有一個 set，改成有多個 register set，可以一次記多個程式的狀態在 hardware register，減少 memeory 的 access
```img
context-switch.png
```

<br>

### Process Scheduling

<br>

- **Multiprogramming**
  - CPU runs process at all times to maxmize CPU utilization
- **Time sharing**
  - switch CPU frequently such that users can interact with each program while it is running
- Processes will have to wait until the CPU is free and can be rescheduled
- Processes migrate between the various queues
  - Job queue (New State)
    - set of **all processes** in the system
  - Ready queue (Ready State)
    - set of all processes residing in main memory, **ready and waiting to execute**
  - Device queue (Wait State)
    - set of processes **waiting for an I/O device**

```img
process-scheduling-diagram.png
```
- time slice expired
  - timer fired
- fork a child
  - create a child process and execute it first, put parent process into waiting queue
- wait for interrupt
  - sleep()


### Operations on Processes

<br>

### Interprocess Communication

<br>

